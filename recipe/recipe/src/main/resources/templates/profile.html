<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회원 정보 수정</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        /* 배너 스타일 */
        .banner {
            background-color: #ffe69b;
            text-align: center;
            padding: 100px 0;
            font-size: 36px;
            font-weight: bold;
            color: white;
        }

        /* 메뉴바 스타일 */
        .menu-bar {
            background-color: #ffe69b; /* 배너와 동일한 배경색 */
            padding: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .menu-bar ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
        }

        /* 메뉴 버튼 스타일 */
        .menu-bar ul li {
            padding: 0 15px;
        }

        .menu-bar ul li a {
            background-color: #ffe69b; /* 배너와 동일한 배경색 */
            color: black; /* 메뉴 텍스트는 검정색 */
            text-decoration: none;
            font-size: 18px;
        }

        .menu-bar ul li a:hover {
            text-decoration: underline;
        }

        body {
            background-color: #f8f9fa;
            font-family: 'Arial', sans-serif;
        }
        .header {
            background-color: #a0d8a0;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header a {
            color: black;
            font-size: 18px;
            text-decoration: none;
            padding: 0 20px;
        }
        .container {
            max-width: 600px;
            margin: 50px auto;
            background-color: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }
        .btn-primary {
            background-color: #bacd92;
            border: none;
        }
        .btn-primary:hover {
            background-color: #bacd92;
        }
        .profile-pic {
            text-align: center;
            margin-bottom: 40px;
        }
        .profile-pic img {
            border-radius: 50%;
            width: 150px;
            height: 150px;
            object-fit: cover;
        }
    </style>
</head>
<body>
    <div class="banner">재료백과</div>

    <!-- 메뉴바 영역 -->
    <div class="menu-bar">
        <!-- 왼쪽 메뉴 (홈, 게시판) -->
        <ul>
            <li>
                <a href="index.html">홈</a></li>
            <li><a href="board.html">게시판</a></li>
        </ul>

        <!-- 오른쪽 메뉴 -->
        <ul>
<!--            <li><a href="#" onclick="logout()">로그아웃</a></li>-->
            <li>
                <form id="logoutForm" action="/api/auth/logout" method="post">
                    <button type="submit" style="background: none; border: none; color: black; cursor: pointer">로그아웃</button>
                </form>
            </li>
            <li><a href="mypage.html">마이페이지</a></li>
        </ul>
    </div>

    <div class="container">
        <h2>회원 정보 수정</h2>
        
        <div class="profile-pic">
            <img src="https://via.placeholder.com/150" alt="프로필 이미지">
        </div>
        <button class="btn btn-secondary d-block mx-auto mb-4" onclick="document.getElementById('profile-pic-input').click();">프로필 사진 변경</button>
        <input type="file" id="profile-pic-input" style="display:none;">

        <!-- scripts.js 의 중복 체크 메소드 이용하도록 수정 -->
        <!-- Form 을 제출해서 테이블에 반영하도록 (register 과정과 비슷하게 수정) -->
        <form>
            <div class="form-group">
                <label for="edit-userName">닉네임</label>
                <input type="text" class="form-control" id="edit-userName">
            </div>
            <div class="form-group">
                <label for="edit-email">이메일</label>
                <input type="email" class="form-control" id="edit-email">
                <button type="button" class="btn btn-secondary mt-2" id="checkEmailBtn">중복 확인</button>
                <div id="emailCheckMessage" style="color:red;"></div>
            </div>
            <div class="form-group">
                <label for="edit-phone">전화번호</label>
                <input type="text" class="form-control" id="edit-phone" placeholder="전화번호" required>
                <button type="button" class="btn btn-secondary mt-2" id="checkPhoneBtn">중복 확인</button>
                <div id="phoneCheckMessage"></div>
            </div>
            <div class="form-group">
                <label for="current-password">현재 비밀번호</label>
                <input type="password" class="form-control" id="current-password">
            </div>
            <div class="form-group">
                <label for="new-password">새 비밀번호</label>
                <input type="password" class="form-control" id="new-password">
            </div>
            <div class="form-group">
                <label for="confirm-password">새 비밀번호 확인</label>
                <input type="password" class="form-control" id="confirm-password">
                <div id="password-error" style="color:red;"></div>
            </div>
            <button type="button" class="btn btn-primary">수정</button>
        </form>
    </div>

    <script>
        // 회원 정보 수정 폼 제출 처리
        $('#updateForm').on('submit', function (event) {
            event.preventDefault();  // 폼 제출을 막음

            // 비밀번호 불일치 시 메세지 띄우기
            const password = $('#new-password').val();
            const confirmPassword = $('#confirm-password').val();
            if (password !== confirmPassword) {
                alert('비밀번호가 일치하지 않습니다.');
                return;
            }

            // 수정된 회원 데이터 준비
            const userData = {
                userId: $('#id').val(),  // 사용자의 ID (수정할 정보)
                password: $('#new-password').val(),
                userName: $('#edit-userName').val(),
                email: $('#edit-email').val(),
                phone: $('#edit-phone').val(),
            };

            // 데이터 전송
            fetch('/api/auth/update', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(userData)
            })
                .then(response => response.text())  // 응답을 text로 받음
                .then(data => {
                    if (data === "회원 정보 수정 성공!") {
                        // 성공하면 마이페이지로 리다이렉트
                        window.location.href = 'mypage.html';
                    } else {
                        throw new Error('회원 정보 수정 실패');
                    }
                })
                .catch(error => {
                    console.error('회원 정보 수정 실패:', error);
                    alert('회원 정보 수정 실패');
                });
        });
    </script>
</body>
</html>
